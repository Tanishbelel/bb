{% extends 'base.html' %}

{% block title %}Learning Modules - PaisaBuddy{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f8f9fa;
    }
    
    .learning-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .module-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
        cursor: pointer;
    }
    
    .module-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .module-header {
        height: 120px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .module-icon {
        font-size: 3rem;
        color: white;
        z-index: 2;
        position: relative;
    }
    
    .difficulty-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 3;
    }
    
    .progress-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: rgba(255,255,255,0.3);
    }
    
    .progress-fill {
        height: 100%;
        background: #28a745;
        transition: width 0.3s ease;
    }
    
    .category-filter {
        margin-bottom: 2rem;
    }
    
    .filter-btn {
        margin: 0.25rem;
        border-radius: 25px;
        padding: 0.5rem 1.5rem;
        border: 2px solid #dee2e6;
        background: white;
        color: #495057;
        transition: all 0.2s ease;
    }
    
    .filter-btn:hover, .filter-btn.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    .achievement-popup {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1050;
        max-width: 300px;
        display: none;
    }
    
    .slide-up {
        animation: slideUp 0.6s ease-out;
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .learning-path {
        background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        border-radius: 15px;
        color: white;
        margin-bottom: 2rem;
    }
    
    .stats-mini {
        background: white;
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Learning Header -->
    <div class="learning-header p-4 slide-up">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2">
                    <i class="fas fa-graduation-cap me-3"></i>Learning Modules
                </h1>
                <p class="mb-3 opacity-90">Master financial literacy through interactive lessons and practical exercises</p>
                <div class="d-flex flex-wrap gap-3">
                    <span class="badge bg-light text-dark px-3 py-2">
                        <i class="fas fa-book me-2"></i>{{ completed_modules|default:"8" }} Completed
                    </span>
                    <span class="badge bg-success px-3 py-2">
                        <i class="fas fa-trophy me-2"></i>{{ total_points|default:"1250" }} XP Earned
                    </span>
                    <span class="badge bg-warning text-dark px-3 py-2">
                        <i class="fas fa-clock me-2"></i>{{ total_time|default:"4.5" }}h Studied
                    </span>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="row">
                    <div class="col-6">
                        <div class="stats-mini">
                            <h3 class="text-primary mb-1">{{ progress_percentage|default:"40" }}%</h3>
                            <small class="text-muted">Progress</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stats-mini">
                            <h3 class="text-success mb-1">{{ current_streak|default:"7" }}</h3>
                            <small class="text-muted">Day Streak</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Path Recommendation -->
    <div class="learning-path p-4 slide-up">
        <h4 class="mb-3">
            <i class="fas fa-route me-2"></i>Recommended Learning Path
        </h4>
        <p class="mb-3 opacity-90">Based on your current level and goals, we suggest following this path:</p>
        <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-light text-dark px-3 py-2">1. Budgeting Basics</span>
            <i class="fas fa-arrow-right align-self-center opacity-75"></i>
            <span class="badge bg-light text-dark px-3 py-2">2. Emergency Fund</span>
            <i class="fas fa-arrow-right align-self-center opacity-75"></i>
            <span class="badge bg-light text-dark px-3 py-2">3. Investment Fundamentals</span>
            <i class="fas fa-arrow-right align-self-center opacity-75"></i>
            <span class="badge bg-light text-dark px-3 py-2">4. Risk Management</span>
        </div>
    </div>

    <!-- Category Filters -->
    <div class="category-filter text-center slide-up">
        <h5 class="mb-3">Choose Your Focus Area</h5>
        <button class="btn filter-btn active" data-category="all">
            <i class="fas fa-th me-2"></i>All Modules
        </button>
        <button class="btn filter-btn" data-category="basics">
            <i class="fas fa-seedling me-2"></i>Basics
        </button>
        <button class="btn filter-btn" data-category="investing">
            <i class="fas fa-chart-line me-2"></i>Investing
        </button>
        <button class="btn filter-btn" data-category="security">
            <i class="fas fa-shield-alt me-2"></i>Security
        </button>
        <button class="btn filter-btn" data-category="advanced">
            <i class="fas fa-brain me-2"></i>Advanced
        </button>
    </div>

    <!-- Learning Modules Grid -->
    <div class="row" id="modules-container">
        <!-- Budgeting Basics -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="basics">
            <div class="module-card" onclick="openModule('budgeting-basics')">
                <div class="module-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="module-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <span class="badge bg-success difficulty-badge">Beginner</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Budgeting Basics</h5>
                    <p class="card-text text-muted">Learn the fundamentals of creating and managing a personal budget effectively.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-success">
                            <i class="fas fa-check-circle me-1"></i>Completed
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>15 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+50 XP</span>
                        <span class="badge bg-outline-secondary">5 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SIP Investing -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="investing" style="animation-delay: 0.1s;">
            <div class="module-card" onclick="openModule('sip-investing')">
                <div class="module-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="module-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <span class="badge bg-warning text-dark difficulty-badge">Intermediate</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">SIP Investing</h5>
                    <p class="card-text text-muted">Understand Systematic Investment Plans and build wealth through disciplined investing.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-primary">
                            <i class="fas fa-play-circle me-1"></i>In Progress
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>20 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+75 XP</span>
                        <span class="badge bg-outline-secondary">7 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPI Security -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="security" style="animation-delay: 0.2s;">
            <div class="module-card" onclick="openModule('upi-security')">
                <div class="module-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="module-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <span class="badge bg-success difficulty-badge">Beginner</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">UPI Security</h5>
                    <p class="card-text text-muted">Master safe digital payment practices and protect yourself from online fraud.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>Not Started
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>10 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+40 XP</span>
                        <span class="badge bg-outline-secondary">4 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Fund -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="basics" style="animation-delay: 0.3s;">
            <div class="module-card" onclick="openModule('emergency-fund')">
                <div class="module-header" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="module-icon">
                        <i class="fas fa-umbrella"></i>
                    </div>
                    <span class="badge bg-success difficulty-badge">Beginner</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Emergency Fund Planning</h5>
                    <p class="card-text text-muted">Build a financial safety net to handle unexpected expenses and emergencies.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-success">
                            <i class="fas fa-check-circle me-1"></i>Completed
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>12 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+45 XP</span>
                        <span class="badge bg-outline-secondary">4 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Investment Fundamentals -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="investing" style="animation-delay: 0.4s;">
            <div class="module-card" onclick="openModule('investment-basics')">
                <div class="module-header" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <div class="module-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <span class="badge bg-warning text-dark difficulty-badge">Intermediate</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 30%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Investment Fundamentals</h5>
                    <p class="card-text text-muted">Learn about different investment options, risk, and return principles.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-primary">
                            <i class="fas fa-play-circle me-1"></i>In Progress
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>25 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+80 XP</span>
                        <span class="badge bg-outline-secondary">8 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mutual Funds -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="investing" style="animation-delay: 0.5s;">
            <div class="module-card" onclick="openModule('mutual-funds')">
                <div class="module-header" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <div class="module-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <span class="badge bg-warning text-dark difficulty-badge">Intermediate</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Mutual Funds Guide</h5>
                    <p class="card-text text-muted">Comprehensive guide to understanding and investing in mutual funds.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>Locked
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>30 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+100 XP</span>
                        <span class="badge bg-outline-secondary">10 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tax Planning -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="advanced" style="animation-delay: 0.6s;">
            <div class="module-card" onclick="openModule('tax-planning')">
                <div class="module-header" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);">
                    <div class="module-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <span class="badge bg-danger difficulty-badge">Advanced</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Tax Planning Strategies</h5>
                    <p class="card-text text-muted">Learn effective tax planning strategies to optimize your financial returns.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>Locked
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>35 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+120 XP</span>
                        <span class="badge bg-outline-secondary">12 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Retirement Planning -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="advanced" style="animation-delay: 0.7s;">
            <div class="module-card" onclick="openModule('retirement-planning')">
                <div class="module-header" style="background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);">
                    <div class="module-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <span class="badge bg-danger difficulty-badge">Advanced</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Retirement Planning</h5>
                    <p class="card-text text-muted">Plan for your future with comprehensive retirement planning strategies.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>Locked
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>40 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+150 XP</span>
                        <span class="badge bg-outline-secondary">15 Lessons</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credit Score -->
        <div class="col-lg-4 col-md-6 mb-4 slide-up module-item" data-category="basics" style="animation-delay: 0.8s;">
            <div class="module-card" onclick="openModule('credit-score')">
                <div class="module-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="module-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <span class="badge bg-success difficulty-badge">Beginner</span>
                    <div class="progress-overlay">
                        <div class="progress-fill" style="width: 80%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Credit Score Management</h5>
                    <p class="card-text text-muted">Understand credit scores and learn how to improve and maintain them.</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-primary">
                            <i class="fas fa-play-circle me-1"></i>In Progress
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>18 min
                        </small>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-primary me-1">+60 XP</span>
                        <span class="badge bg-outline-secondary">6 Lessons</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Footer -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-center text-white p-4">
                    <h4 class="mb-3">Ready to boost your financial knowledge?</h4>
                    <p class="mb-4 opacity-90">Join thousands of users who have improved their financial literacy with PaisaBuddy</p>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <a href="{% url 'dashboard' %}" class="btn btn-light">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </a>
                        <button class="btn btn-warning" onclick="openModule('recommended')">
                            <i class="fas fa-play me-2"></i>Start Recommended Path
                        </button>
                        <a href="{% url 'profile' %}" class="btn btn-outline-light">
                            <i class="fas fa-user me-2"></i>View Progress
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Achievement Popup -->
<div class="achievement-popup" id="achievement-popup">
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>🎉 Achievement Unlocked!</strong>
        <div id="achievement-text">You've started a new learning module!</div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Category Filter Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const filterBtns = document.querySelectorAll('.filter-btn');
        const moduleItems = document.querySelectorAll('.module-item');
        
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                filterBtns.forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                const category = this.getAttribute('data-category');
                
                moduleItems.forEach(item => {
                    if (category === 'all' || item.getAttribute('data-category') === category) {
                        item.style.display = 'block';
                        item.classList.add('slide-up');
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
    });
    
    // Module Opening Function
    function openModule(moduleId) {
        // Show achievement popup
        showAchievement('Learning Journey Continues!', 'You opened a new module. Keep up the great work!');
        
        // Simulate module opening
        const moduleData = {
            'budgeting-basics': {
                title: 'Budgeting Basics',
                description: 'Learn the fundamentals of personal budgeting',
                completed: true
            },
            'sip-investing': {
                title: 'SIP Investing',
                description: 'Master systematic investment planning',
                completed: false
            },
            'upi-security': {
                title: 'UPI Security',
                description: 'Safe digital payment practices',
                completed: false
            },
            'emergency-fund': {
                title: 'Emergency Fund Planning',
                description: 'Build your financial safety net',
                completed: true
            },
            'investment-basics': {
                title: 'Investment Fundamentals',
                description: 'Basic investment principles and strategies',
                completed: false
            }
        };
        
        const module = moduleData[moduleId];
        if (module) {
            if (module.completed) {
                alert(`📚 Opening ${module.title}\n\n${module.description}\n\n✅ Status: Completed\nYou can review this module anytime!`);
            } else {
                alert(`🚀 Starting ${module.title}\n\n${module.description}\n\n📖 Status: Ready to learn\nLet's begin your learning journey!`);
            }
            
            // In a real app, this would navigate to the module content
            // window.location.href = `/learning/module/${moduleId}/`;
        } else {
            alert('🔒 This module is coming soon!\n\nComplete prerequisite modules to unlock advanced content.');
        }
    }
    
    // Achievement Popup Function
    function showAchievement(title, message) {
        const popup = document.getElementById('achievement-popup');
        const textElement = document.getElementById('achievement-text');
        
        textElement.innerHTML = `<strong>${title}</strong><br>${message}`;
        popup.style.display = 'block';
        
        // Auto hide after 4 seconds
        setTimeout(() => {
            popup.style.display = 'none';
        }, 4000);
    }
    
    // Search Functionality (if needed)
    function searchModules(query) {
        const moduleItems = document.querySelectorAll('.module-item');
        const searchTerm = query.toLowerCase();
        
        moduleItems.forEach(item => {
            const title = item.querySelector('.card-title').textContent.toLowerCase();
            const description = item.querySelector('.card-text').textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    // Progress Animation on Hover
    document.querySelectorAll('.module-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            const progressFill = this.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.transition = 'width 0.3s ease';
            }
        });
    });
    
    // Simulate learning streak update
    function updateStreak() {
        const streakElement = document.querySelector('.stats-mini h3');
        if (streakElement && streakElement.textContent !== 'undefined') {
            const currentStreak = parseInt(streakElement.textContent) || 7;
            streakElement.textContent = currentStreak + 1;
            showAchievement('Streak Extended!', `${currentStreak + 1} day learning streak! Keep it up!`);
        }
    }
    
    // Add some gamification
    let userXP = {{ total_points|default:"1250" }};
    
    function addXP(points) {
        userXP += points;
        showAchievement('XP Gained!', `You earned ${points} XP! Total: ${userXP} XP`);
    }
</script>
{% endblock %}